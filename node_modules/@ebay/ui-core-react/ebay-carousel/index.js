"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("react"),S=require("classnames"),z=require("../icon-TuxfQndO.js"),x=require("../debounce-BQsYxxOL.js"),A=require("../common/component-utils/forwardRef/index.js");require("../array.polyfill.flat-5BAolFdk.js");const D={prev:"chevronLeft12",next:"chevronRight12"},V={prev:"LEFT",next:"RIGHT"},q=({type:e,label:t,hidden:n,disabled:r,onClick:l})=>{const c=s=>{l(s,{direction:V[e]})};return o.createElement("button",{className:S("carousel__control",`carousel__control--${e}`),"aria-label":t,"aria-disabled":r,disabled:r,onClick:c},o.createElement(z.EbayIcon,{className:S("icon",`icon--carousel-${e}`),focusable:!1,name:D[e],"aria-hidden":n}))};function H(e){const t=e.parentElement,n=t?t.firstElementChild.getBoundingClientRect().left:0,{left:r,right:l}=e.getBoundingClientRect();return{left:r-n,right:l-n}}const W=e=>getComputedStyle(e).overflowX!=="visible",y=(e,t)=>{if(!e.length)return 0;const n=e[e.length-1];return Math.max(n.right-t,0)||0},j=(e,t,n)=>e.length&&Math.min(e[t].left,y(e,n))||0,G=(e,t,n,r,l,c)=>o.Children.map(e,(s,a)=>{const{style:i={}}=s.props;let d;if(n){const u=n+n%1;d=`calc(${100/u}% - ${(u-1)*c/u}px)`}const f=n?a%n===0:!0;return o.cloneElement(s,{...s.props,slideWidth:r,offset:l,ref:u=>{t.current[a]=u},className:f?"carousel__snap-point":s.props.className,style:{...i,width:d||i.width,marginRight:c&&a!==o.Children.count(e)-1?`${c}px`:i.marginRight}})}),O=(e,t,n)=>{if(e>0){let r=e;return r%=t.length||1,r-=r%(n||1),r=Math.abs(r),r}return 0},U=(e,t,n=e)=>{if(t)return Math.ceil(n/t)},X=e=>e==="LEFT"?-1:1,J=(e,t,n,r,l)=>{let c=t,s;if(e==="LEFT"&&c===0)c=n.length-1;else{do{const a=X(e);s=n[c+=a]}while(s&&s.fullyVisible);if(e==="LEFT"&&!l){const a=s.right-r;do s=n[--c];while(s&&s.left>=a);c+=1}}return O(c,n,l)},K=(e,t,n,r=1,l)=>{let c;if(e>=y(t,n)-l)c=t.length-1;else{const s=t.length;let a=0,i=Math.ceil(s/r)-1;for(;i-a>1;){const u=Math.floor((a+i)/2);e>t[u*r].left?a=u:i=u}const d=Math.abs(e-t[a*r].left),f=Math.abs(e-t[i*r].left);c=O((d>f?i:a)*r,t,r)}return c},Q=(e,t)=>{let n,r,l;return function c(){const{scrollLeft:s}=e;if(l!==s){l=s,n=setTimeout(()=>{r=requestAnimationFrame(c)},90);return}t(l)}(),()=>{clearTimeout(n),cancelAnimationFrame(r)}},Y=typeof window<"u"&&"scrollBehavior"in document.body.style;function B(e,t,n){if(Y)return e.scrollTo({left:t}),Q(e,n);let r,l,c=requestAnimationFrame(u=>{const{scrollLeft:g}=e,L=t-g,h=450;(function T(p){const m=p-u;if(m>h)return e.scrollLeft=t,s(),n();e.scrollLeft=Z(m/h)*L+g,c=requestAnimationFrame(T)})(u)});return e.addEventListener("touchstart",a),s;function s(){cancelAnimationFrame(c),r===void 0?d():(l&&l(),f())}function a(){s(),r=e.scrollLeft,e.addEventListener("touchend",i)}function i(){f(),r===e.scrollLeft&&(l=B(e,t,n))}function d(){e.removeEventListener("touchstart",a)}function f(){e.removeEventListener("touchend",i)}}function Z(e){return e<.5?2*e*e:-1+(4-2*e)*e}const P=({gap:e=16,itemsPerSlide:t,slideWidth:n,offset:r,activeIndex:l,nextControlDisabled:c,className:s,itemsRef:a,children:i,onSetActiveIndex:d,onScroll:f})=>{const[u,g]=o.useState(0),[L,h]=o.useState(!1),[T,p]=o.useState(!1),m=o.useRef(null),E=o.useRef(null);o.useEffect(()=>{if(!o.Children.count(i)||!m.current)return;if(L){h(!1);return}const b=m.current;W(b)?(p(!0),B(b,r,()=>p(!1))):g(r)},[r]);const C=o.useCallback(()=>{const v=m.current.scrollLeft,b=K(v,a.current,n,t,e);b!==l&&(h(!0),d(b),f({index:b}))},[m.current,a.current,n,l,d]),R=()=>{E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{T||C()},640)};return o.createElement("div",{className:S("carousel__viewport",{"carousel__viewport--mask":!c},s)},o.createElement("ul",{className:"carousel__list",ref:m,onScroll:R,style:{transform:`translate3d(${-u}px, 0, 0)`}},G(i,a,t,n,r,e)))},ee=({gap:e=16,index:t=0,itemsPerSlide:n,a11yPreviousText:r,a11yNextText:l,onScroll:c=()=>{},onNext:s=()=>{},onPrevious:a=()=>{},onSlide:i=()=>{},className:d,children:f,...u})=>{const[g,L]=o.useState(t),[h,T]=o.useState(0),[p,m]=o.useState(0),E=o.useRef(null),C=o.useRef([]),R=o.Children.count(f),v=Math.floor(n)||void 0,b=R<=v,I=b||p===0,_=b||p===y(C.current,h),N=()=>{if(!E.current)return;const{width:w}=E.current.getBoundingClientRect();T(w)};o.useEffect(()=>(window.addEventListener("resize",x.debounce(N,16)),()=>{window.removeEventListener("resize",x.debounce(N,16))}),[]),o.useEffect(()=>{m(j(C.current,g,h))},[g,h]),o.useEffect(()=>{t>=0&&t<=R-1&&L(t)},[t]),o.useEffect(()=>{C.current=C.current.splice(0,R)},[f]),o.useEffect(()=>{const{width:w}=E.current.getBoundingClientRect();T(w)},[E.current]);const F=(w,{direction:M})=>{const k=J(M,g,C.current,h,v),$=U(g,v,k);L(k),M==="LEFT"?a(w):s(w),i({slide:$})};return o.createElement("div",{className:S("carousel",d,{"carousel--slides":v,"carousel--peek":v%1===0}),...u},o.createElement("div",{ref:E,className:"carousel__container"},o.createElement(q,{label:r,type:"prev",disabled:I,onClick:F}),o.createElement(P,{itemsRef:C,offset:p,gap:e,itemsPerSlide:v,nextControlDisabled:_,activeIndex:g,onScroll:c,onSetActiveIndex:L,slideWidth:h},f),o.createElement(q,{type:"next",label:l,disabled:_,onClick:F})))},te=({slideWidth:e,offset:t,forwardedRef:n,children:r,...l})=>{const c=o.useRef(),[s,a]=o.useState(!1);return o.useImperativeHandle(n,()=>{if(!c.current)return;const{left:i,right:d}=H(c.current),f=i===void 0||i-t>=-.01&&d-t<=e+.01;return a(f),{left:i,right:d,fullyVisible:f}},[e,t]),o.createElement("li",{ref:c,"aria-hidden":!s,...l},r)},ne=A.withForwardRef(te);exports.EbayCarousel=ee;exports.EbayCarouselItem=ne;
